const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PostForm-CH5NkUbG.js","assets/query-vendor-CVtgHnZ_.js","assets/react-vendor-31zzwpBM.js","assets/radix-vendor-hfgbE2XR.js","assets/index-DGDx6rXF.js","assets/utils-vendor-B_WdigmM.js","assets/index-_u7sPNxg.css","assets/Textarea-C6yzHASN.js","assets/useToast-BqvFf6JD.js","assets/ConfirmDialog-C0gHY9We.js"])))=>i.map(i=>d[i]);
import{C as e,P as s,_ as t}from"./index-DGDx6rXF.js";import{j as r,u as a,b as n,c as o}from"./query-vendor-CVtgHnZ_.js";import{r as i,L as l}from"./react-vendor-31zzwpBM.js";import{h as c,I as d,F as m,i as u,T as x,j as p,C as g,k as h}from"./radix-vendor-hfgbE2XR.js";import{f,O as j,u as y,L as v,E as b,B as N,a as P,b as w}from"./useToast-BqvFf6JD.js";import"./utils-vendor-B_WdigmM.js";const E=i.memo(function({post:e,onDelete:s,onEdit:t}){const a=e.content.length>200?`${e.content.substring(0,200)}...`:e.content,n=f(e.createdAt);return r.jsx("article",{className:"card hover:shadow-md transition-shadow",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx(l,{to:`/post/${e.id}`,className:"block group",children:r.jsx("h2",{className:"text-xl font-semibold text-gray-900 group-hover:text-primary-600 transition-colors mb-2",children:e.title})}),r.jsx("p",{className:"text-gray-700 mb-4 line-clamp-3",children:a}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(c,{className:"inline-flex items-center justify-center align-middle overflow-hidden select-none w-8 h-8 rounded-full bg-primary-100",children:[r.jsx(d,{src:e.avatar,alt:e.name,className:"w-full h-full object-cover"}),r.jsx(m,{className:"w-full h-full flex items-center justify-center bg-primary-500 text-white text-xs font-medium",children:e.name.charAt(0).toUpperCase()})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),r.jsx("p",{className:"text-xs text-gray-500",children:n})]})]})]}),r.jsx(j,{ariaLabel:"Opciones del post",items:[{label:"Editar",onClick:()=>t(e),variant:"default"},{label:"Eliminar",onClick:()=>s(e.id),variant:"danger"}]})]})})}),C=i.lazy(()=>t(()=>import("./PostForm-CH5NkUbG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>({default:e.PostForm}))),S=i.lazy(()=>t(()=>import("./ConfirmDialog-C0gHY9We.js"),__vite__mapDeps([9,1,2,3,4,5,6,8])).then(e=>({default:e.ConfirmDialog})));function q(){const t=a(),l=y(),[c,d]=i.useState(!1),[m,f]=i.useState(null),[j,q]=i.useState("newest"),[_,k]=i.useState(null),I=i.useRef(null),{data:F,fetchNextPage:K,hasNextPage:A,isFetchingNextPage:O,isLoading:Q,error:D}=n({queryKey:["posts",j],queryFn:({pageParam:e=1})=>w.getPosts(e,10,j),getNextPageParam:(e,s)=>10===e.length?s.length+1:void 0,initialPageParam:1}),L=F?.pages.flat()??[];i.useEffect(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting&&A&&!O&&K()},{threshold:.1}),s=I.current;return s&&e.observe(s),()=>{s&&e.unobserve(s)}},[A,O,K]);const T=i.useRef(!1);i.useEffect(()=>{D&&!T.current&&(T.current=!0,l.error("Error al cargar los posts. Por favor, intenta nuevamente.")),D||(T.current=!1)},[D]);const z=o({mutationFn:async e=>(await w.deleteAllComments(e),w.deletePost(e)),onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["posts"]}),t.removeQueries({queryKey:["post",s]}),t.removeQueries({queryKey:["comments",s]}),k(null),l.success("Post eliminado correctamente")},onError:()=>{l.error("Error al eliminar el post. Por favor, intenta nuevamente.")}}),R=o({mutationFn:w.createPost,onSuccess:e=>{t.invalidateQueries({queryKey:["posts"]}),t.removeQueries({queryKey:["post",e.id]}),t.removeQueries({queryKey:["comments",e.id]}),l.success("Post creado correctamente")},onError:()=>{l.error("Error al crear el post. Por favor, intenta nuevamente."),d(!0)}}),M=o({mutationFn:({postId:e,post:s})=>w.updatePost(e,s),onSuccess:()=>{t.invalidateQueries({queryKey:["posts"]}),f(null),l.success("Post actualizado correctamente")},onError:()=>{l.error("Error al actualizar el post. Por favor, intenta nuevamente."),m&&d(!0)}}),V=()=>{f(null),d(!0)},W=e=>{f(e),d(!0)},$=e=>{k(e)};return Q?r.jsx(v,{message:"Cargando posts..."}):D?r.jsx(b,{message:"Error al cargar los posts",action:r.jsx(N,{onClick:()=>t.invalidateQueries({queryKey:["posts"]}),children:"Reintentar"})}):r.jsxs("div",{children:[(z.isPending||M.isPending||R.isPending)&&r.jsx(P,{message:z.isPending?"Eliminando post...":M.isPending?"Guardando cambios...":"Creando post..."}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4 md:mb-0",children:"Posts"}),r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-end gap-3 md:gap-3",children:[r.jsxs(u,{children:[r.jsx(x,{asChild:!0,children:r.jsx(N,{variant:"secondary",leftIcon:r.jsx(e,{className:"w-4 h-4"}),fullWidth:!0,className:"md:w-auto",children:"newest"===j?"Más recientes":"Más antiguos"})}),r.jsx(p,{children:r.jsxs(g,{className:"min-w-[180px] bg-white rounded-lg shadow-lg border border-gray-200 p-1 z-50",align:"end",children:[r.jsx(h,{className:"px-3 py-2 text-sm rounded-md cursor-pointer focus:outline-none focus:bg-gray-100 "+("newest"===j?"bg-primary-50 text-primary-700 font-medium":"text-gray-700 hover:bg-gray-100"),onSelect:()=>q("newest"),children:"Más recientes primero"}),r.jsx(h,{className:"px-3 py-2 text-sm rounded-md cursor-pointer focus:outline-none focus:bg-gray-100 "+("oldest"===j?"bg-primary-50 text-primary-700 font-medium":"text-gray-700 hover:bg-gray-100"),onSelect:()=>q("oldest"),children:"Más antiguos primero"})]})})]}),r.jsx(N,{onClick:V,leftIcon:r.jsx(s,{className:"w-5 h-5"}),fullWidth:!0,className:"md:w-auto",children:"Nuevo Post"})]})]}),0!==L.length||Q?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex flex-col gap-6",children:L.map(e=>r.jsx(E,{post:e,onDelete:$,onEdit:W},e.id))}),r.jsx("div",{ref:I,className:"py-4",children:O&&r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"}),r.jsx("p",{className:"ml-3 text-gray-600",children:"Cargando más posts..."})]})})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-gray-600 mb-4",children:"No hay posts aún"}),r.jsx(N,{onClick:V,children:"Crear el primer post"})]}),c&&r.jsx(i.Suspense,{fallback:null,children:r.jsx(C,{post:m,isOpen:c,onClose:()=>{d(!1),f(null)},onSubmit:e=>{d(!1),m?M.mutate({postId:m.id,post:{...e,createdAt:m.createdAt}}):R.mutate({...e,createdAt:(new Date).toISOString()})}})}),_&&r.jsx(i.Suspense,{fallback:null,children:r.jsx(S,{isOpen:!!_,onClose:()=>k(null),onConfirm:()=>{_&&z.mutate(_)},title:"Eliminar Post",description:"¿Estás seguro de que quieres eliminar este post? Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger"})})]})}export{q as PostsList};
